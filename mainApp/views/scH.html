<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒ³TWOGETHER</title>
    <link rel="stylesheet" href="/stylesheets/scH.css">
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic+Coding&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">

</head>

<body style="font-size: 22px;">

    <header>
        <div>
            <img src="images/twogether-logo.png" onclick="move()" alt="ë¡œê³ " width="380px" height="140px">
        </div>
        <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=f9a5c956172b9d5f4228f9b7b68540e1"></script>
    </header>
    <nav>
        <ul class="menubar">
            <span class="menu1"> <a href="/">í™ˆ</a></span>
            <span class="menu2"> <a href="/map">ìƒíƒœê´€ê´‘ì§€ ì¶”ì²œ</a></span>
            <span class="menu3"> <a href="/scH">ê´€ê´‘ ì•ˆë‚´ì†Œ</a></span>
            <span class="menu4"> <a href="/namuGrow">ë‚˜ë¬´ í‚¤ìš°ê¸°</a></span>
        </ul>
    </nav>

    <div class="box1">
        <div class="box2">
            <div class="searchBox">
                <input type="text" id="sh" placeholder="ì „êµ­ ê´€ê´‘ ì•ˆë‚´ì†Œ ê²€ìƒ‰">
                <input type="button" class="search" type="submit" name="click" value="" ><i id="sIcon" class="fas fa-solid fa-magnifying-glass" onclick="searchTourismInfo()"></i></button>
            </div>
            <div class="ntic" id="ntic">
                <div class="table-container">
                    <table>
                      <tr>
                        <th>ì´ë¦„</th>
                        <th>ì£¼ì†Œ</th>
                        <th>í™ˆí˜ì´ì§€ ì£¼ì†Œ</th>
                        <th>ì˜ì—…ì‹œê°„</th>
                      </tr>
                      <tbody id="tableBody"></tbody>
                    </table>
                  </div>
                  
            </div>
        </div>
    </div>
    
    <script>
        function move() {
            location.href = "/";
        }

        // ì‹¤ì œ API ì—”ë“œí¬ì¸íŠ¸ë¡œ ëŒ€ì²´í•´ì•¼ í•©ë‹ˆë‹¤.
var url = 'http://api.data.go.kr/openapi/tn_pubr_public_trsmic_api'; /*URL*/
var queryParams = '?' + encodeURIComponent('serviceKey') + '=' + `dTbTVKBhYqclSFuHS2cAH%2BX9k1Y8T35mSxoJMrsH19fRZad%2FF4rDnJEONc4r366Y%2B08r8SlY5AXUi8rOLGH8fw%3D%3D`; /*Service Key*/
queryParams += '&' + encodeURIComponent('pageNo') + '=' + encodeURIComponent('1'); /* */
queryParams += '&' + encodeURIComponent('numOfRows') + '=' + encodeURIComponent('100'); /* */
queryParams += '&' + encodeURIComponent('type') + '=' + encodeURIComponent('json'); /* */

const apiUrl = url + queryParams;

const getXMLfromAPI = async() => {
    try {
        const reqURL = `${url}${queryParams}`;
        const response = await fetch(reqURL);
        const jsonData = await response.text();

        console.log(jsonData);
    } catch (error) {
        console.error('ì˜¤ë¥˜ ë°œìƒ:', error);
    }
};

// ëª¨ë“  ê´€ê´‘ì•ˆë‚´ì†Œ ì •ë³´ë¥¼ ë°›ì•„ì˜¤ëŠ” í•¨ìˆ˜
const getAllTourismInfo = async () => {
  try {
    const reqURL = `${url}${queryParams}`;
    const response = await fetch(reqURL);
    const jsonData = await response.text();

    // JSON ë°ì´í„°ë¥¼ íŒŒì‹±
    const allTourismInfo = JSON.parse(jsonData).response.body.items;
    console.log(allTourismInfo);

    return allTourismInfo;
  } catch (error) {
    console.error('ì˜¤ë¥˜ ë°œìƒ:', error);
    throw error;
  }
};

// ê²€ìƒ‰ ê¸°ëŠ¥
async function searchTourismInfo() {
  var searchInput = document.getElementById('sh').value;
  console.log(searchInput);

  try {
    // ëª¨ë“  ê´€ê´‘ì•ˆë‚´ì†Œ ì •ë³´ ë°›ì•„ì˜¤ê¸°
    const allTourismInfo = await getAllTourismInfo();

    // ê²€ìƒ‰ì–´ê°€ ì—†ìœ¼ë©´ ëª¨ë“  ì •ë³´ ì¶œë ¥
    if (!searchInput) {
      displayTourismInfo(allTourismInfo);
      return;
    }

    // ê²€ìƒ‰ì–´ê°€ ìˆëŠ” ê²½ìš°, ê²€ìƒ‰ì–´ê°€ í¬í•¨ëœ ì •ë³´ë§Œ í•„í„°ë§í•˜ì—¬ ì¶œë ¥
    const filteredTourismInfo = allTourismInfo.filter(item =>
      item.trsmicNm.includes(searchInput)
    );

    displayTourismInfo(filteredTourismInfo);
  } catch (error) {
    console.error('API ìš”ì²­ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
  }
}
//ì—”í„°í‚¤
document.getElementById('sh').addEventListener('keyup', function(event) {
  if (event.key === 'Enter') {
    searchTourismInfo();
  }
});

// ê´€ê´‘ì•ˆë‚´ì†Œ ì •ë³´ë¥¼ í™”ë©´ì— ì¶œë ¥í•˜ëŠ” í•¨ìˆ˜
function displayTourismInfo(infoArray) {
  const tableBody = document.getElementById('tableBody');
  tableBody.innerHTML = '';

  if (infoArray.length === 0) {
    tableBody.innerHTML = '<tr><td colspan="3">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
    return;
  }

  infoArray.forEach(item => {
    const row = document.createElement('tr');
    const openTime = item.summerOperOpenHhmm;
    const closeTime = item.summerOperCloseHhmm;
    const combinedTime = `${openTime}-${closeTime}`;

    row.innerHTML = `
      <td style="color: #142c07;">${item.trsmicNm}</td>
      <td style="color: #142c07;">${item.rdnmadr}</td>
      <td style="color: #142c07;"><a href="${item.homepageUrl}" style="color: #142c07;">${item.homepageUrl}</a></td>
      <td style="color: #142c07;">${combinedTime}</td>
    `;
    tableBody.appendChild(row);
  });
}


    </script>

</body>

</html>